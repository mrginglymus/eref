{% extends 'app.html' %}

{% block progress %}
{% include 'progress.html' %}
{% endblock %}

{% from 'macros.html' import text_input, saveandnext, select_input, modal %}

{% block content %}

<h2 id="reference">Reference</h2>
<p>In your reference please comment on:</p>
<ul style="margin-left: 20px">
  <li>The applicant’s academic results to date</li>
  <li>The applicant’s academic fitness and general suitability to undertake the proposed course of research or study, in relation to the qualification sought</li>
  <li>A justification of any difference between the applicants academic ranking and your estimate of their suitability for the course</li>
  <li>If the applicant’s native language is not English, their level of fluency and proficiency in English, particularly in the context of their academic work</li>
  <li>If the applicant is intending to study part-time, their ability to manage different responsibilities simultaneously;</li>
  <li>Any other information which you think is relevant to the application (e.g., research experience, ability to work independently, key strengths /weaknesses)</li>
</ul>
 
{% if not method %}
<h2 style="text-align:center;">Please select how you would like to provide your reference</h2>
<div class="row">
  <div class="col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
    <div class="row">
      <div class="col-xs-6">
        <a href="./?method=write#reference" style="display:block; width: 150px; margin: 0 auto; text-align:center; white-space:normal;" class="btn btn-secondary">
          <span class="fa fa-pencil fa-4x"></span><br>
          Write online or copy from document
        </a>
      </div>
      <div class="col-xs-6">
        <a href="./?method=upload#reference" style="display:block; width: 150px; margin: 0 auto; text-align:center; white-space:normal;" class="btn btn-secondary">
          <span class="fa fa-file-text-o fa-4x"></span><br>
          Select a document from your computer
        </a>
      </div>
    </div>
  </div>
</div>
{% elseif method=='write' %}
<div class="row">
  <div class="col-md-6">
    <h3>Write reference online or copy from document</h3>
  </div>
  <div class="col-md-6">
    <a href="#switchdoc" data-toggle="modal" class="secondary-cta pull-right">Switch to select a document from your computer</a>
  </div>
</div>
<textarea id="reference_write" class="form-control" name="reference_write"><p>Blah bla balh</p></textarea>
<script type="text/javascript">
  $(document).ready(function() {
    tinymce.init({
      selector:'#reference_write',
      toolbar: 'undo redo | bold italic | bullist numlist ',
      statusbar: false,
      height: '300px',
      menubar: false,
      plugins: 'paste',
      valid_elements: 'strong/b,em/i,u,ol,ul,li,p',
      setup: function(editor) {
        editor.on('keyup', function(e) {
          $('form').toggleClass('dirty', editor.targetElm.value!=editor.getContent());
        });
      }
    });
  });
</script>
{% elseif method=='upload' %}
<div class="row">
  <div class="col-md-6">
    <h3>Select a document from your computer</h3>
  </div>
  <div class="col-md-6">
    <a href="#switchtext" data-toggle="modal" class="secondary-cta pull-right">Switch to write reference online or copy from document</a>
  </div>
</div>
<div class="well">
  <input type="file" id="file" class="form-control-file">
</div>
{% endif %}
<hr>
<h2>Data Protection Act</h2>
<div class="checkbox">
  <label>
    <input type="checkbox" name="dpayes">
      <strong>I understand that the University will treat the reference in strict confidence insofar as the law permits, but may be required by law to disclose it to the applicant under the Data Protection Act (1988)</strong>
  </label>
</div>
<fieldset class="form-group">
  <p>If there are any factors that you think should be taken into account if the applicant makes a request to view this reference, please give them here:</p>
  <textarea class="form-control" rows="5" style="resize:none;" name="dpatext"></textarea>
</fieldset>
{{ saveandnext('../review') }}

{{ modal('Switch to document?', 'switchdoc', 'If you wish to select a document instead, any text you have given already will be discarded.', './?method=upload#reference', 'Discard text and switch to document', 'Cancel') }}
{{ modal('Switch to write online?', 'switchtext', 'If you wish to write the reference online, or copy it from a document, any document you have already selected will be discarded.', './?method=write#reference', 'Discard document and switch to write online', 'Cancel') }}

<script type="text/javascript">
  $(document).on('ready', function() {
    $('input[name="arno"]').on('change', function() {
      $('[name="arposition"], [name="arsize"], [name="basis"]').attr('disabled', $(this).is(':checked'))
      if ($(this).is(':checked')) {
        $('[name="arposition"], [name="arsize"]').val('');
        $('[name="basis"]').each(function(i, e) {e.selectedIndex=0;});
      }
    });
    $('input[name="perno"]').on('change', function() {
      $('[name="ranking"], [name="ranking_reason"], [name="ranking_number"]').attr('disabled', $(this).is(':checked'))
      if ($(this).is(':checked')) {
        $('[name="ranking"], [name="ranking_reason"]').each(function(i, e) {e.selectedIndex=0;});
        $('[name="ranking_number"]').val('');
      }
    });
  });
</script>
{% endblock %}
